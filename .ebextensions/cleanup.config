commands:
  01_clean_old_deployments:
    command: |
      # Remove old app versions keeping only the last 2
      find /var/app/ondeck -mindepth 1 -maxdepth 1 -type d | sort -r | tail -n +3 | xargs rm -rf || true
      # Clean pip cache
      pip cache purge || true
      # Clean tmp
      rm -rf /tmp/* || true
    ignoreErrors: true

  02_clean_docker_if_applicable:
    command: |
      if command -v docker &> /dev/null; then
        docker system prune -f || true
      fi
    ignoreErrors: true